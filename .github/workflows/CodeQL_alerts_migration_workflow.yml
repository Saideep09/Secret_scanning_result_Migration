name: Migrate Code Scanning Alerts

on:
  workflow_dispatch:  # Allows manual triggering of the workflow

jobs:
  migrate_sarif:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up GitHub CLI
        uses: cli/gh-action@v2
        with:
          version: latest

      - name: Create SARIF directory
        run: mkdir -p sarif_reports

      - name: List and download SARIF files
        id: download_sarif
        run: |
          # List all analysis runs and retrieve each SARIF file
          analysis_ids=$(gh api -X GET /repos/Saideep09/zxing-sample-java/code-scanning/analyses | jq -r '.[].id')
          for analysis_id in $analysis_ids; do
            gh api -X GET /repos/Saideep09/zxing-sample-java/code-scanning/analyses/$analysis_id --jq '.sarif' > sarif_reports/analysis_${analysis_id}.sarif
            echo "Downloaded SARIF for analysis ID: $analysis_id"
          done
